global_defs {
	# Keepalived process identifier
	lvs_id <%= p('keepalived.lvs_id') %>
}
# Script used to check if HAProxy is running
vrrp_script <%= p('keepalived.healthcheck_name') %> {
	script "<%= p('keepalived.healthcheck_command') %>"
	interval 2
	weight 2
}
# Virtual interface
# The priority specifies the order in which the assigned interface to take over in a failover
vrrp_instance <%= p('keepalived.vrrp_instance_name') %> {
	<% if p('keepalived.masterip').include? spec.networks.marshal_dump.first[1].ip %>
	state MASTER
	priority 101
	<% else %>
	state SLAVE
	priority 100
	<% end %>
	interface <%= p('keepalived.interface') %>
	virtual_router_id 51
# The virtual ip address shared between the two loadbalancers
	virtual_ipaddress {
		<%= p('keepalived.vip') %>
	}
	track_script {
		<%= p('keepalived.healthcheck_name') %>
	}
}
<% if p('keepalived.masterip').include? spec.networks.marshal_dump.first[1].ip %>
#master
<% else %>
#slave
<% end %>
